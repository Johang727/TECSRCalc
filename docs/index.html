<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">
<title>SR Calculator</title>
<!--mstheme--><link rel="stylesheet" type="text/css" href="themes/slate/slat1011.css"><meta name="Microsoft Theme" content="slate 1011">
<meta name="Microsoft Border" content="tlb, default">
</head>

<body>
<p>&nbsp;</p>
    
<!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>


</td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%">


</td><td valign="top" width="24"></td><!--msnavigation--><td valign="top">

<div align="center">
    <center>
    <table border="0" width="100%" cellpadding="5">
        <tr>
            <td width="330" style="border-style: none; border-width: medium" align="left" valign="top">
            <b><font size="5">SR Calculator:</font></b><p><b>DPM :</b> <input type="text" id="dpm" name="Subject" size="40"></p>
            <p><b>APM :</b> <input type="text" id="apm" name="Subject0" size="40"><br>
&nbsp;</p>
            <p>
            <input type="button" value="Calculate SR!" name="calcSR" onclick="getPrediction()">
            <p><b>SR: <span id="result-container">Yet to run!</span></b></td>
            <td width="10" style="border-style: none; border-width: medium">
            </td>
            <td width="330" style="border-style: none; border-width: medium" align="left" valign="top">
            <b><font size="5">Statistics: </font></b>
            <p id="metrics-content">Loading...</p>
            </td>
        </tr>
    </table>
    </center></div>
<div align="center">
    <center></center></div>



<script>
    const API_URL = 'https://tecsrcalc.onrender.com';

    async function getPrediction() {
        const dpm = document.getElementById('dpm').value;
        const apm = document.getElementById('apm').value;
        const resultContainer = document.getElementById('result-container');

        if (dpm === "" || apm === "") {
            resultContainer.innerText = "Please enter both DPM and APM.";
            return;
        }

        resultContainer.innerText = "Calculating... First run might take a while...";

        try {
            const response = await fetch(`${API_URL}/predict`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ dpm, apm })
            });

            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.error) {
                resultContainer.innerText = `Error: ${data.error}`;
            } else {
                resultContainer.innerHTML = `${data.sr} &plusmn; ${data.std}`;
            }

        } catch (error) {
            console.error("Calculation failed:", error);
            resultContainer.innerText = "Failed to calculate SR! Check the console for details.";
        }
    }

    async function getMetrics() {
        const metricsContainer = document.getElementById('metrics-content');
        try {
            const response = await fetch(`${API_URL}/metrics`);
            const data = await response.json();
            
            if (data.error) {
                metricsContainer.innerText = `Error: ${data.error}`;
            } else {
                // Build the SR distribution list
                let distributionHtml = '<ul>';
                for (const bin in data.srCounts) {
                    distributionHtml += `<li><b>${bin}:</b> ${data.srCounts[bin]}</li>`;
                }
                distributionHtml += '</ul>';

                metricsContainer.innerHTML = `
					<p><b>Last Updated:</b> ${data.timestamp}</p>
                    <p><b>RÂ²:</b> ${data.r2}</p>
                    <p><b>MSE:</b> ${data.mse}</p>
					<p><b>Data Size:</b> ${data.size}</p>
                    <h3>SR Distribution in Training Data:</h3>
                    ${distributionHtml}
                `;
            }
        } catch (error) {
            console.error("Metrics fetch failed:", error);
            metricsContainer.innerText = "Failed to load metrics!";
        }
    }

    document.addEventListener('DOMContentLoaded', getMetrics);
</script>

<p align="left"><small><small>Render hosts the backend for this website so please be patient on first run!</small></small></p>


<!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>


<p>&nbsp;</p>
<hr align="left">
<img src="images/paws.jpg" alt="Made with my own two front paws :3">
<p align="left"><small>
<nobr>Home</nobr> ||  <nobr><A HREF="about.html" TARGET="" STYLE="text-decoration: none;">About</A></nobr>
</small></p>
</td></tr><!--msnavigation--></table></body>

</html>