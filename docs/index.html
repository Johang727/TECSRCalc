<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">
<title>SR Calculator</title>
<!--mstheme--><link rel="stylesheet" type="text/css" href="themes/slate/slat1011.css"><meta name="Microsoft Theme" content="slate 1011">
<meta name="Microsoft Border" content="tlb, default">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono&display=swap" rel="stylesheet">
<link rel="icon" href="images/icon.png">
</head>

<body>
<p>&nbsp;</p>
    
<!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>


</td></tr><!--msnavigation--></table><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td valign="top" width="1%">


</td><td valign="top" width="24"></td><!--msnavigation--><td valign="top">

<div align="center">
    <center>
    <table border="0" width="100%" cellpadding="5">
        <tr>
            <td width="330" style="border-style: none; border-width: medium" align="left" valign="top">
            <b><font size="5">SR Calculator:</font></b><p>                
            
            <p><b>Date :</b> <span id="date-container">...</span></p>

            <p><b>DPM :</b> <input type="text" id="dpm" name="DPM" size="40"></p>

            <p><b>APM :</b> <input type="text" id="apm" name="APM" size="40"><br>

            <p><b>APP :</b> <span id="efish-container">Enter data + run...</span></p>
            
            <p><b>Model :</b> 
                <select name="Model" id="modelSelect">
                    <option value="All">All Models (Recommended)</option>
                    <option value="Auto">Auto (Legacy)</option>
                    <option value="Linear">Linear</option>
                    <option value="RandomForest">Random Forest</option>
                    <option value="GradientBoosting">Gradient Boosting</option>
                    <option value="RF_GB_Ensemble">Random Forest + Gradient Boosting</option>
                </select>
            </p>



            <input type="button" value="Calculate SR!" name="calcSR" onclick="getPrediction()">
            <p><b>SR: <span id="result-container">Yet to run!</span></b>
            <p><b>Model Used: <span id="model-container">Yet to run!</span></b></td>

            <td width="10" style="border-style: none; border-width: medium">
            </td>
            <td width="330" style="border-style: none; border-width: medium" align="left" valign="top">
            <b><font size="5">Statistics: </font></b>
            <p id="metrics-content">Loading...</p>
            <hr>
            <b><font size="5">Model Usage: </font></b>
            <pre>

- <b>All:</b><br>
    - Run them all and take the average.<br>
    - Has proven to be the best with my tests.
        - This works because the Linear model tends to undershoot and the others tend to overshoot, leading to a pretty accurate SR.<br>
    - Will not provide an uncertainty range.<br>

- <b>Auto:</b><br>
    - Old default, here just in-case you want to use it.<br>
    - Selects <b>Linear</b> when out of training data range.<br>
    - Selects <b>Random Forest</b> + <b>Gradient Boosting</b> when within training data range.<br>
    - Will not provide an uncertainty range.<br>


- <b>Linear (Auto):</b><br>
    - Good for predicting outside of the training data range.<br>
    - Will not provide an uncertainty range.<br>

- <b>Random Forest:</b><br>
    - Good for predicting within of the training data range.<br>
    - Will provide an uncertainty range.<br>

- <b>Gradient Boosting:</b><br>
    - Similar to Random Forest: each tree learns from each other, rather than being seperate.<br>
    - Will not provide an uncertainty range.<br>


- <b>Random Forest + Gradient Boosting (Auto):</b><br>
    - Essentially takes the average of the two outputs.<br>
    - Will not provide an uncertainty range.<br>


            </pre>

            </td>
        </tr>
    </table>
    </center></div>
<div align="center">
    <center></center></div>



<script>
    const API_URL = 'https://api.tecsrcalc.org';
    //const API_URL = ''

    async function getPrediction() {
        const dpm = document.getElementById('dpm').value;
        const apm = document.getElementById('apm').value;
        const modelSelect = document.getElementById('modelSelect').value;
        const resultContainer = document.getElementById('result-container');
        const modelContainer = document.getElementById('model-container');
        const efishContainer = document.getElementById("efish-container");

        if (dpm === "" || apm === "") {
            resultContainer.innerText = "Please enter both DPM and APM.";
            return;
        }


        if (dpm == 0 || apm == 0) {
            resultContainer.innerText = "Please enter both DPM and APM.";
            return;
        }

        resultContainer.innerText = "Calculating... First run might take a while...";

        try {
            const response = await fetch(`${API_URL}/predict`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ dpm, apm , modelSelect})
            });

            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.error) {
                resultContainer.innerText = `Error: ${data.error}`;
            } else {
                resultContainer.innerHTML = `${data.sr}`;
                modelContainer.innerHTML = `${data.model}`;
                efishContainer.innerHTML = `${data.app}`;
            }

        } catch (error) {
            console.error("Calculation failed:", error);
            resultContainer.innerText = "Failed to calculate SR! Check the console for details.";
        }
    }

    async function getMetrics() {
        const metricsContainer = document.getElementById('metrics-content');
        const dateContainer = document.getElementById("date-container");
        try {
            const response = await fetch(`${API_URL}/metrics`);
            const data = await response.json();

            if (response.ok) {
                metricsContainer.innerHTML = `<pre>${data.metrics}</pre>`;
                dateContainer.innerHTML = `${data.date}`;
            } else {
                console.error("Metrics fetch failed:", error);
                metricsContainer.innerText = "Failed to load metrics!";
                dateContainer.innerText = "Failed to load.";
            }

        } catch (error) {
            console.error("Metrics fetch failed:", error);
            metricsContainer.innerText = "Failed to load metrics!";
            dateContainer.innerText = "Failed to load.";
        }
    }
    document.addEventListener('DOMContentLoaded', getMetrics);
</script>

<p align="left"><small><small>Render no longer hosts the backend! Everything should be quicker now!</small></small></p>

<!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>


<p>&nbsp;</p>
<hr align="left">

<p align="left"><small>
<nobr>Home</nobr> ||  <nobr><A HREF="about.html" TARGET="" STYLE="text-decoration: none;">About</A></nobr>
</small></p>
</td></tr><!--msnavigation--></table></body>

</html>
